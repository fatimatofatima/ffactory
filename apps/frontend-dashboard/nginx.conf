events { worker_connections 1024; }
http {
    include /etc/nginx/mime.types;
    default_type application/octet-stream;
    
    upstream api_backend        { server investigation-api:8080; }
    upstream analytics_backend  { server behavioral-analytics:8080; }
    upstream feedback_backend   { server feedback-api:8070; }
    upstream case_backend       { server case-manager:8140; }
    upstream gateway_backend    { server api-gateway:8170; }
    upstream ai_backend         { server ai-reporting:8081; }

    server {
        listen 3000;
        server_name localhost;
        root /usr/share/nginx/html;
        index index.html;

        # Serve static files
        location / {
            try_files $uri $uri/ /index.html;
        }

        # API routes
        location /api/          { proxy_pass http://api_backend/; }
        location /analytics/    { proxy_pass http://analytics_backend/; }
        location /feedback/     { proxy_pass http://feedback_backend/; }
        location /cases/        { proxy_pass http://case_backend/; }
        location /gateway/      { proxy_pass http://gateway_backend/; }
        location /ai/           { proxy_pass http://ai_backend/; }

        # Health checks
        location /health {
            proxy_pass http://api_backend/health;
            auth_basic off;
        }

        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
